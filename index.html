<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Prince of Ruins - Animated</title>
    <style>
        body { background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; font-family: sans-serif; }
        canvas { background: #000; border: 4px solid #5d4037; margin-top: 20px; image-rendering: pixelated; } /* Пиксели будут четкими */
        .ui { background: #2d2d2d; padding: 20px; border-radius: 10px; margin-top: 10px; width: 760px; text-align: center; }
        #question-box { display: none; background: #3d3d3d; padding: 15px; margin-top: 10px; border-left: 5px solid #e67e22; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #d35400; color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>

    <h1>PRINCE OF PERSIA: RUINS</h1>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    
    <div class="ui">
        <div id="status">СТРЕЛКИ — движение, ПРОБЕЛ — прыжок</div>
        <div id="question-box">
            <h3 id="question-text">Вопрос...</h3>
            <button onclick="checkAnswer(true)">Ударить мечом (Правильно)</button>
            <button onclick="checkAnswer(false)">Ошибка</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ЗАГРУЗКА СПРАЙТА
        const sprite = new Image();
        sprite.src = 'hero.png'; 

        const levels = [
            { name: "Руины", color: "#2c3e50", ground: "#27ae60", wallPos: 600, wallHp: 2, question: "Как пишется: (не)былица?" },
            { name: "Храм", color: "#1a1a1a", ground: "#34495e", wallPos: 500, wallHp: 3, question: "Корень в слове 'выращивать'?" }
        ];

        let currentLevel = 0;
        let hero = { 
            x: 50, y: 280, w: 80, h: 80, // Размеры на экране
            vx: 0, vy: 0, 
            speed: 5, jumpPower: -12, gravity: 0.6, 
            grounded: false, state: 'idle',
            frame: 0, frameTimer: 0, dir: 1 
        };

        // Настройки кадров (на основе твоего изображения)
        const frameW = 250; // Ширина одного кадра в картинке
        const frameH = 250; // Высота одного кадра в картинке
        const anims = {
            'idle': { row: 0, frames: 4 },
            'run':  { row: 1, frames: 4 },
            'hit':  { row: 2, frames: 3 } // Нижний ряд - приседание/удар
        };

        let wall = { exists: true, hp: levels[0].wallHp, maxHp: levels[0].wallHp };
        let keys = {};

        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        function update() {
            if (hero.state === 'locked' || hero.state === 'hit') return;

            if (keys['ArrowRight']) { hero.vx = hero.speed; hero.state = 'run'; hero.dir = 1; }
            else if (keys['ArrowLeft']) { hero.vx = -hero.speed; hero.state = 'run'; hero.dir = -1; }
            else { hero.vx = 0; hero.state = 'idle'; }

            if (keys['Space'] && hero.grounded) { hero.vy = hero.jumpPower; hero.grounded = false; }
            
            hero.vy += hero.gravity; hero.x += hero.vx; hero.y += hero.vy;

            if (hero.y > 280) { hero.y = 280; hero.vy = 0; hero.grounded = true; }
            if (hero.x > canvas.width) nextLevel();

            let lvl = levels[currentLevel];
            if (wall.exists && hero.x + 50 > lvl.wallPos && hero.x < lvl.wallPos + 50) {
                hero.x = lvl.wallPos - 50; hero.state = 'locked'; showQuestion();
            }
        }

        function draw() {
            let lvl = levels[currentLevel];
            ctx.fillStyle = lvl.color; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = lvl.ground; ctx.fillRect(0, 360, canvas.width, 40);

            if (wall.exists) {
                ctx.fillStyle = "#5d4037"; ctx.fillRect(lvl.wallPos, 280, 80, 80);
                ctx.fillStyle = "white"; ctx.fillText(`Прочность: ${wall.hp}`, lvl.wallPos, 270);
            }

            // АНИМАЦИЯ
            hero.frameTimer++;
            if (hero.frameTimer > 10) { // Скорость анимации
                hero.frame = (hero.frame + 1) % anims[hero.state].frames;
                hero.frameTimer = 0;
            }

            // Рисуем героя
            ctx.save();
            if (hero.dir === -1) { // Поворот персонажа влево
                ctx.translate(hero.x + hero.w, hero.y);
                ctx.scale(-1, 1);
                ctx.drawImage(sprite, hero.frame * frameW, anims[hero.state].row * frameH, frameW, frameH, 0, 0, hero.w, hero.h);
            } else {
                ctx.drawImage(sprite, hero.frame * frameW, anims[hero.state].row * frameH, frameW, frameH, hero.x, hero.y, hero.w, hero.h);
            }
            ctx.restore();

            update();
            requestAnimationFrame(draw);
        }

        function showQuestion() {
            document.getElementById('question-box').style.display = 'block';
            document.getElementById('question-text').innerText = levels[currentLevel].question;
        }

        function checkAnswer(isCorrect) {
            if (isCorrect) {
                hero.state = 'hit'; // Включаем анимацию удара
                setTimeout(() => {
                    wall.hp--;
                    if (wall.hp <= 0) {
                        wall.exists = false; hero.state = 'idle';
                        document.getElementById('question-box').style.display = 'none';
                    } else {
                        hero.state = 'locked';
                    }
                }, 500);
            } else {
                hero.x = 50; wall.hp = wall.maxHp; hero.state = 'idle';
                document.getElementById('question-box').style.display = 'none';
            }
        }

        function nextLevel() {
            currentLevel++;
            if (currentLevel >= levels.length) currentLevel = 0;
            hero.x = 50; wall.exists = true; wall.hp = levels[currentLevel].wallHp;
        }

        sprite.onload = () => { draw(); }; // Запуск после загрузки картинки
    </script>
</body>
</html>
