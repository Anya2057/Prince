<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Prince of Ruins: Fixed</title>
    <style>
        body { background: #1a1a1a; color: white; display: flex; flex-direction: column; align-items: center; font-family: sans-serif; margin: 0; }
        canvas { background: #2c3e50; border: 4px solid #5d4037; margin-top: 20px; image-rendering: pixelated; }
        .ui { background: #2d2d2d; padding: 20px; border-radius: 10px; margin-top: 10px; width: 760px; text-align: center; }
        #question-box { display: none; background: rgba(0,0,0,0.8); padding: 20px; border: 2px solid gold; position: absolute; top: 150px; }
        button { padding: 12px 24px; margin: 10px; cursor: pointer; background: #d35400; color: white; border: 2px solid #fff; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>

    <canvas id="gameCanvas" width="800" height="400"></canvas>
    
    <div id="question-box">
        <h3 id="question-text">Вопрос...</h3>
        <button onclick="checkAnswer(true)">УДАРИТЬ (Верно)</button>
        <button onclick="checkAnswer(false)">ОШИБКА</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        const heroImg = new Image();
        heroImg.src = 'hero.png'; 

        // Настройки кадра под вашу картинку (1024x1024, 4x3 кадра)
        const sW = 256; 
        const sH = 256;
        
        let hero = { 
            x: 50, y: 250, w: 120, h: 120, // Увеличил размер, чтобы принца было лучше видно
            vx: 0, vy: 0, speed: 5, jumpPower: -15, gravity: 0.8, 
            grounded: false, state: 'idle', frame: 0, fTimer: 0, dir: 1 
        };

        const anims = {
            'idle': { row: 0, frames: 4 },
            'run':  { row: 1, frames: 4 },
            'locked': { row: 0, frames: 1 }, // Просто стоит перед стеной
            'hit':  { row: 2, frames: 3 }
        };

        let wall = { x: 600, y: 250, w: 80, h: 110, hp: 3, exists: true };
        let keys = {};

        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        function update() {
            if (hero.state === 'locked' || hero.state === 'hit') {
                hero.vx = 0;
            } else {
                if (keys['ArrowRight']) { hero.vx = hero.speed; hero.state = 'run'; hero.dir = 1; }
                else if (keys['ArrowLeft']) { hero.vx = -hero.speed; hero.state = 'run'; hero.dir = -1; }
                else { hero.vx = 0; hero.state = 'idle'; }
            }

            if (keys['Space'] && hero.grounded && hero.state !== 'locked') { 
                hero.vy = hero.jumpPower; hero.grounded = false; 
            }
            
            hero.vy += hero.gravity; hero.x += hero.vx; hero.y += hero.vy;
            if (hero.y > 250) { hero.y = 250; hero.vy = 0; hero.grounded = true; }

            // Проверка стены
            if (wall.exists && hero.x + 80 > wall.x && hero.x < wall.x + 40) {
                hero.x = wall.x - 80;
                if (hero.state !== 'locked' && hero.state !== 'hit') {
                    hero.state = 'locked';
                    document.getElementById('question-box').style.display = 'block';
                    document.getElementById('question-text').innerText = "Как пишется: (НЕ)БЫЛИЦА?";
                }
            }
        }

        function draw() {
            ctx.clearRect(0,0,800,400);
            
            // Земля
            ctx.fillStyle = "#27ae60";
            ctx.fillRect(0, 360, 800, 40);

            // Стена
            if (wall.exists) {
                ctx.fillStyle = "#5d4037";
                ctx.fillRect(wall.x, wall.y, wall.w, wall.h);
                ctx.fillStyle = "white";
                ctx.fillText("ПРОЧНОСТЬ: " + wall.hp, wall.x, wall.y - 10);
            }

            // Логика кадров
            hero.fTimer++;
            if (hero.fTimer > 8) {
                hero.frame = (hero.frame + 1) % anims[hero.state].frames;
                hero.fTimer = 0;
            }

            // Рисуем принца
            ctx.save();
            if (hero.dir === -1) {
                ctx.translate(hero.x + hero.w, hero.y);
                ctx.scale(-1, 1);
                ctx.drawImage(heroImg, hero.frame * sW, anims[hero.state].row * sH, sW, sH, 0, 0, hero.w, hero.h);
            } else {
                ctx.drawImage(heroImg, hero.frame * sW, anims[hero.state].row * sH, sW, sH, hero.x, hero.y, hero.w, hero.h);
            }
            ctx.restore();

            update();
            requestAnimationFrame(draw);
        }

        function checkAnswer(correct) {
            if (correct) {
                hero.state = 'hit';
                hero.frame = 0;
                setTimeout(() => {
                    wall.hp--;
                    if (wall.hp <= 0) {
                        wall.exists = false;
                        document.getElementById('question-box').style.display = 'none';
                        hero.state = 'idle';
                    } else {
                        hero.state = 'locked';
                    }
                }, 600);
            } else {
                hero.x -= 200; 
                hero.state = 'idle';
                document.getElementById('question-box').style.display = 'none';
            }
        }

        heroImg.onload = () => draw();
    </script>
</body>
</html>
